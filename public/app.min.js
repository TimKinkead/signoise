"use strict";try{var app=angular.module("app",["ui.router","ui.bootstrap","ngResource","ngSanitize"]);app.config(["$locationProvider","$urlRouterProvider",function(a,b){a.html5Mode({enabled:!0,requireBase:!0}),b.otherwise("/")}]),window.ie9&&!window.location.hash&&window.location.pathname.length<=1&&(console.log("IE 9 requires # for client side routing."),window.location.assign("/#/"+window.location.search))}catch(e){window.location.assign("/unsupported")}angular.module("app").config(["$stateProvider",function(a){a.state("home",{url:"/",templateUrl:"modules/main/home/view.html",controller:"HomeController"}),a.state("dashboard",{url:"/dashboard",templateUrl:"modules/main/dashboard/view.html",controller:"DashboardController",data:{memberOnly:!0}}),a.state("user",{template:"<div ui-view></div>",controller:"UserController","abstract":!0}),a.state("user.signup",{url:"/sign-up",templateUrl:"modules/main/user/views/sign-up.html",data:{guestOnly:!0}}),a.state("user.login",{url:"/login",templateUrl:"modules/main/user/views/login.html",data:{guestOnly:!0}}),a.state("user.settings",{url:"/settings",templateUrl:"modules/main/user/views/settings.html",data:{memberOnly:!0}}),a.state("socialseeds",{url:"/social-seeds",templateUrl:"modules/main/social-seeds/view.html",controller:"SocialSeedsController",data:{memberOnly:!0}}),a.state("socialmedia",{url:"/social-media",templateUrl:"modules/main/social-media/view.html",controller:"SocialMediaController",data:{memberOnly:!0}}),a.state("webpages",{url:"/web-pages",templateUrl:"modules/main/web-pages/view.html",controller:"WebPagesController",data:{memberOnly:!0}}),a.state("websites",{url:"/web-sites",templateUrl:"modules/main/web-sites/view.html",controller:"WebSitesController",data:{memberOnly:!0}})}]),angular.module("app").config(["$httpProvider",function(a){a.defaults.headers["delete"]={"Content-Type":"application/json;charset=utf-8"},a.defaults.cache=!1,a.defaults.headers.get||(a.defaults.headers.get={}),a.defaults.headers.get["If-Modified-Since"]="0";var b;a.interceptors.push(["$q","$injector",function(a,c){return{responseError:function(d){function e(){b=!1,f.$broadcast("CloseErrorModal")}var f=c.get("$rootScope"),g=c.get("ErrorModal");return b?a.reject(d):(b=!0,g.open(d,e),a.reject(d))}}}])}]),angular.module("app").run(["$rootScope","$state","CurrentUser",function(a,b,c){function d(){return Boolean(c.data&&c.data._id)}a.$on("$stateChangeStart",function(a,c,e,f,g){c.data&&c.data.guestOnly&&d()?(a.preventDefault(),b.go("dashboard")):c.data&&c.data.memberOnly&&!d()&&(a.preventDefault(),b.go("home"))})}]),angular.module("app").run(["$location","ErrorModal",function(a,b){var c=a.search();c.header&&c.message&&(b.open({header:c.header,message:c.message}),a.search({})),"_=_"===a.hash()&&a.url(a.path())}]),angular.module("app").service("CurrentUser",["$window",function(a){return{data:a.user||{}}}]),angular.module("app").service("ErrorModal",["$uibModal",function(a){var b=function(b,c){if(!angular.isObject(b))return void c();if(b=b.data?b.data:b,!(b.header&&b.header.length&&b.message&&b.message.length))return void c();var d=a.open({templateUrl:"modules/parts/error-modal/view.html",controller:["$scope","$uibModalInstance","info","$http",function(a,b,c,d){a.rejection=c.rejection,a.retry=function(){d(c.rejection.data.retry),b.close()},a.cancel=function(){b.dismiss("cancel")},a.$on("$stateChangeStart",a.cancel)}],resolve:{info:function(){return{rejection:b}}}});angular.isFunction(c)&&d.result.then(c,c)};return{open:b}}]),angular.module("app").filter("capitalize",[function(){return function(a){switch(a=a||"",a.length){case 0:return a;case 1:return a.toUpperCase();default:return a[0].toUpperCase()+a.slice(1)}}}]),angular.module("app").controller("NavbarController",["$scope","CurrentUser",function(a,b){a.user=b.data,a.toggleNavbar=function(){angular.element(document.getElementById("navbar-collapse")).toggleClass("in")},a.tables=[{state:"socialseeds",name:"Social Seeds"},{state:"socialmedia",name:"Social Media"},{state:"websites",name:"Web Sites"},{state:"webpages",name:"Web Pages"}],a.logout=function(a){a&&a.preventDefault(),window.location.assign("/data/user/sign-out")}}]),angular.module("app").directive("navbar",[function(){return{restrict:"A",templateUrl:"modules/parts/navbar/view.html",scope:{},controller:"NavbarController"}}]),angular.module("app").controller("DashboardController",["$scope","CurrentUser",function(a,b){a.user=b.data,a.connectTwitter=function(){window.location.assign("/data/user/twitter/connect")},a.connectFacebook=function(){window.location.assign("/data/user/facebook/connect")}}]),angular.module("app").controller("HomeController",["$scope",function(a){a.message="Something cool."}]),angular.module("app").controller("SocialMediaController",["$scope","$resource","$uibModal","$window",function(a,b,c,d){function e(){if(!(h.length<f+g)){var a=1.2*d.innerHeight,c=document.getElementsByClassName("last-row");c=c.length?c[0].getBoundingClientRect().top:!1,c&&a>c&&(f+=g,b("data/socialmedia/list").query({skip:f,limit:g},function(a){a.length<g&&angular.element(d).unbind("scroll"),angular.forEach(a,function(a,b){h.push(a)})}))}}a.summary=b("data/socialmedia/summary").get(),a.filterBy="ready";var f=0,g=20,h=a.media=b("data/socialmedia/list").query({skip:f,limit:g,filterBy:a.filterBy});a.fields=["date","text","seed","platform","status","processed"],a.dates=["date","processed","modified","created"];angular.element(d).bind("scroll",e),a.$watch("filterBy",function(c,i){c!==i&&(angular.element(d).unbind("scroll"),f=0,h=a.media=b("data/socialmedia/list").query({skip:f,limit:g,filterBy:c},function(){angular.element(d).bind("scroll",e)}))}),a.download=function(){var a=c.open({templateUrl:"modules/main/social-media/download/view.html",controller:"SocialMediaDownloadController"});a.result.then(function(){console.log("close")},function(){console.log("dismiss")})},a.read=function(a){var b=c.open({templateUrl:"modules/main/social-media/read/view.html",controller:"SocialMediaReadController",resolve:{info:function(){return{mediaDocId:a._id}}}});b.result.then(function(){console.log("close")},function(){console.log("dismiss")})}}]),angular.module("app").controller("SocialMediaDownloadController",["$scope","$uibModalInstance","$window",function(a,b,c){var d=a.skip=0,e=a.limit=1e5;a.download=function(){c.location.href="http://"+c.location.host+"/data/socialmedia/download?skip="+d+"&limit="+e},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("app").controller("SocialMediaReadController",["$scope","$uibModalInstance","info","$http","$resource",function(a,b,c,d,e){a=angular.extend(a,c);var f=a.mediaDoc=e("data/socialmedia").get({_id:c.mediaDocId});a.fields=["_id","date","text","seed","platform","data","status","processed","meta"],a.dates=["date","processed","modified","created"],a.showData=!1,a.showMeta=!1,a.cancel=function(){b.dismiss("cancel")},a.getMediaText=function(){return f&&f.text?f.text.length>200?f.text.slice(0,200)+"...":f.text:""},a.toggleData=function(){a.showData=!a.showData,a.showData&&(a.showMeta=!1)},a.toggleMeta=function(){a.showMeta=!a.showMeta,a.showMeta&&(a.showData=!1)},a.getDataAsJSON=function(){return JSON.stringify(f.data,null,4)},a.getMetaAsJSON=function(){return JSON.stringify(f.meta,null,4)}}]),angular.module("app").controller("SocialSeedsController",["$scope","$resource","$uibModal","$window","$http",function(a,b,c,d,e){function f(){if(!(j.length<g+h)){var a=1.2*d.innerHeight,c=document.getElementsByClassName("last-row");c=c.length?c[0].getBoundingClientRect().top:!1,c&&a>c&&(g+=h,b("data/socialseed/list").query({filterBy:i,skip:g,limit:h},function(a){a.length<h&&angular.element(d).unbind("scroll"),angular.forEach(a,function(a,b){j.push(a)})}))}}a.summary=b("data/socialseed/summary").get();var g=0,h=20,i=a.filterBy="active",j=a.seeds=b("data/socialseed/list").query({filterBy:i,skip:g,limit:h}),k=a.fields=["title","platform","frequency","references","media","initialized"],l=a.dates=["initialized","created"];a.create=function(){var a=c.open({templateUrl:"modules/main/social-seeds/create/view.html",controller:"SocialSeedsCreateController"});a.result.then(function(a){j.push(a)},function(){console.log("dismiss")})},a.edit=function(a){var b=c.open({templateUrl:"modules/main/social-seeds/edit/view.html",controller:"SocialSeedsEditController",resolve:{info:function(){return{seed:angular.copy(a),fields:k,dates:l}}}});b.result.then(function(b){b.update?a=angular.extend(a,b.update):b["delete"]&&j.splice(j.indexOf(a),1)},function(){console.log("dismiss")})},angular.element(d).bind("scroll",f),a.$watch("filterBy",function(c,e){c!==e&&(angular.element(d).unbind("scroll"),g=0,j=a.seeds=b("data/socialseed/list").query({filterBy:c,skip:g,limit:h},function(){angular.element(d).bind("scroll",f)}))}),a.showPullBtns="localhost"===d.location.hostname,a.pullTwitter=function(){e.get("/data/socialmedia/pull/twitter").success(function(a){}).error(function(a){})},a.pullFacebook=function(){e.get("/data/socialmedia/pull/facebook").success(function(a){}).error(function(a){})}}]),angular.module("app").controller("SocialSeedsCreateController",["$scope","$uibModalInstance","$http","$resource",function(a,b,c,d){var e=a.status={step:1},f=a.platforms=["facebook","instagram","twitter"],g=a.seed={platform:"facebook",frequency:"daily"};a.cancel=function(){b.dismiss("cancel")},a.save=function(){c.post("data/socialseed",g).success(function(a){b.close(a)}).error(function(a){})},a.active=f.indexOf(g.platform),a.$watch("active",function(a,b){if(a!==b)switch(g.platform=f[a],g.platform){case"facebook":g.facebook={},g.twitter&&delete g.twitter;break;case"twitter":g.twitter={},g.facebook&&delete g.facebook}}),a.searchFacebook=function(){e.processing=!0,e.errorMessage=null,a.facebookResults=d("data/socialseed/facebook/search").get({query:g.facebook.title},function(){e.processing=!1},function(a){e.processing=!1,e.errorMessage="Error! Please try again.\n"+a})},a.selectFacebook=function(b){a.facebookFields=["id","name","category"],e.step=2,g.facebook={id:b.id,name:b.name,category:b.category?b.category:"Group"}}}]),angular.module("app").controller("SocialSeedsEditController",["$scope","$uibModalInstance","info","$http","$resource",function(a,b,c,d,e){a=angular.extend(a,c),a.showHistory=!1,a.fullSeed=null,a.cancel=function(){b.dismiss("cancel")},a.save=function(){d.put("data/socialseed",{_id:c.seed._id,frequency:c.seed.frequency}).success(function(){b.close({update:c.seed})}).error(function(a){})},a["delete"]=function(e){return e?(d["delete"]("data/socialseed",{data:{_id:c.seed._id}}).success(function(){b.close({"delete":!0})}).error(function(a){}),void b.close({"delete":!0})):void(a.confirmDelete=!a.confirmDelete)},a.toggleHistory=function(){a.showHistory=!a.showHistory,a.fullSeed||(a.fullSeed=e("data/socialseed").get({_id:c.seed._id}))},a.getQuery=function(a){return encodeURIComponent(a)}}]),angular.module("app").controller("UserController",["$scope","$http","$resource","$state","CurrentUser",function(a,b,c,d,e){function f(a){a&&a.message&&(j.message=a.message),j.processing=!1}function g(a){j.successMessage=a,setTimeout(function(){j.successMessage=null},1e3)}function h(a){a&&a._id?(e.data=angular.extend(e.data,a),d.go("dashboard")):f({message:"We had trouble logging you in. Please try again."})}var i=a.user={},j=a.status={};a.signUp=function(){return i.email&&i.password?(j.processing=!0,void b.post("/data/user/sign-up",i).success(h).error(f)):void(j.message="*Email and password are required!")},a.login=function(){return i.email&&i.password?(j.processing=!0,void b.post("/data/user/sign-in",i).success(h).error(f)):void(j.message="*Email and password are required!")};var k;d.is("user.settings")&&(i=a.user=c("data/user/settings").get(function(){k=angular.copy(i)},f));var l=a.showEdit=function(b,c){a["edit"+b]=c?!1:!0};a.update=function(a){function c(){l(a,!0),"Email"===a?(k.email=i.email,e.data.username=i.email.slice(0,i.email.indexOf("@")),g("Email address updated!")):"Password"===a&&g("Password changed!"),j.processing=!1}var d={};switch(a){case"Email":if(!i.email||i.email===k.email)return i.email=k.email,void l("Email",!0);d.email=i.email;break;case"Password":if(!i.password&&!i.newPassword)return void l("Password",!0);if(!i.password)return void(j.message="Please provide your current password.");if(!i.newPassword)return void(j.message="Please provide a new password.");d.password=i.password,d.newPassword=i.newPassword}j.processing=!0,b.put("/data/user/settings",d).success(c).error(f)},a.toggleTwitter=function(){j.processing=!0,i.twitter?b.get("/data/user/twitter/disconnect").success(function(){i.twitter=!1,j.processing=!1,g("Twitter Disconnected!")}).error(f):window.location.assign("/data/user/twitter/connect")},a.toggleFacebook=function(){j.processing=!0,i.facebook?b.get("/data/user/facebook/disconnect").success(function(){i.facebook=!1,j.processing=!1,g("Facebook Disconnected!")}).error(f):window.location.assign("/data/user/facebook/connect")}}]),angular.module("app").controller("WebPagesController",["$scope","$resource","$uibModal","$http","$window",function(a,b,c,d,e){function f(){if(!(i.length<g+h)){var a=1.2*e.innerHeight,c=document.getElementsByClassName("last-row");c=c.length?c[0].getBoundingClientRect().top:!1,c&&a>c&&(g+=h,b("data/webpage/list").query({skip:g,limit:h},function(a){a.length<h&&angular.element(e).unbind("scroll"),angular.forEach(a,function(a,b){i.push(a)})}))}}a.showPullBtns="localhost"===e.location.hostname,a.summary=b("data/webpage/summary").get(),a.filterBy="pending";var g=0,h=20,i=a.pages=b("data/webpage/list").query({skip:g,limit:h,filterBy:a.filterBy});a.fields=["url","status","type","crawlDate","title","links","references","referencesSocialMedia","created"],a.dates=["crawlDate","created"];a.download=function(){e.location.href="http://"+e.location.host+"/data/webpage/download"},angular.element(e).bind("scroll",f),a.$watch("filterBy",function(c,d){c!==d&&(angular.element(e).unbind("scroll"),g=0,i=a.pages=b("data/webpage/list").query({skip:g,limit:h,filterBy:c},function(){angular.element(e).bind("scroll",f)}))})}]),angular.module("app").controller("WebSitesController",["$scope","$resource","$uibModal","$window",function(a,b,c,d){function e(){if(!(h.length<f+g)){var a=1.2*d.innerHeight,c=document.getElementsByClassName("last-row");c=c.length?c[0].getBoundingClientRect().top:!1,c&&a>c&&(f+=g,b("data/website/list").query({skip:f,limit:g},function(a){a.length<g&&angular.element(d).unbind("scroll"),angular.forEach(a,function(a,b){h.push(a)})}))}}a.summary=b("data/website/summary").get(),a.filterBy="crawl";var f=0,g=20,h=a.sites=b("data/socialsite/list").query({skip:f,limit:g,filterBy:a.filterBy}),i=a.fields=["domain","url","crawl","category","notes","useRobots","disallow","fetched","ignored","redirected","scheduled","references","created"],j=a.dates=["created"];a.create=function(){var a=c.open({templateUrl:"modules/main/web-sites/create/view.html",controller:"WebSitesCreateController"});a.result.then(function(a){h.push(a)},function(){console.log("dismiss")})},a.edit=function(a){var b=c.open({templateUrl:"modules/main/web-sites/edit/view.html",controller:"WebSitesEditController",resolve:{info:function(){return{site:angular.copy(a),fields:i,dates:j}}}});b.result.then(function(b){b.update?a=angular.extend(a,b.update):b["delete"]&&h.splice(h.indexOf(a),1)},function(){console.log("dismiss")})},angular.element(d).bind("scroll",e),a.$watch("filterBy",function(c,i){c!==i&&(angular.element(d).unbind("scroll"),f=0,h=a.sites=b("data/website/list").query({skip:f,limit:g,filterBy:c},function(){angular.element(d).bind("scroll",e)}))})}]);