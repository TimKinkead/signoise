"use strict";try{var app=angular.module("app",["ui.router","ui.bootstrap","ngResource","ngSanitize"]);app.config(["$locationProvider","$urlRouterProvider",function(a,b){a.html5Mode({enabled:!0,requireBase:!0}),b.otherwise("/")}]),window.ie9&&!window.location.hash&&window.location.pathname.length<=1&&(console.log("IE 9 requires # for client side routing."),window.location.assign("/#/"+window.location.search))}catch(e){console.log(e),window.location.assign("/unsupported")}angular.module("app").config(["$stateProvider",function(a){a.state("home",{url:"/",templateUrl:"modules/main/home/view.html",controller:"HomeController"}),a.state("dashboard",{url:"/dashboard",templateUrl:"modules/main/dashboard/view.html",controller:"DashboardController",data:{memberOnly:!0}}),a.state("user",{template:"<div ui-view></div>",controller:"UserController","abstract":!0}),a.state("user.signup",{url:"/sign-up",templateUrl:"modules/main/user/views/sign-up.html",data:{guestOnly:!0}}),a.state("user.login",{url:"/login",templateUrl:"modules/main/user/views/login.html",data:{guestOnly:!0}}),a.state("user.settings",{url:"/settings",templateUrl:"modules/main/user/views/settings.html",data:{memberOnly:!0}}),a.state("districts",{url:"/districts",templateUrl:"modules/main/districts/view.html",controller:"DistrictsController",data:{memberOnly:!0}}),a.state("socialseeds",{url:"/social-seeds",templateUrl:"modules/main/social-seeds/view.html",controller:"SocialSeedsController",data:{memberOnly:!0}}),a.state("socialmedia",{url:"/social-media",templateUrl:"modules/main/social-media/view.html",controller:"SocialMediaController",data:{memberOnly:!0}}),a.state("webpages",{url:"/web-pages",templateUrl:"modules/main/web-pages/view.html",controller:"WebPagesController",data:{memberOnly:!0}}),a.state("websites",{url:"/web-sites",templateUrl:"modules/main/web-sites/view.html",controller:"WebSitesController",data:{memberOnly:!0}})}]),angular.module("app").config(["$httpProvider",function(a){a.defaults.headers["delete"]={"Content-Type":"application/json;charset=utf-8"},a.defaults.cache=!1,a.defaults.headers.get||(a.defaults.headers.get={}),a.defaults.headers.get["If-Modified-Since"]="0";var b;a.interceptors.push(["$q","$injector",function(a,c){return{responseError:function(d){function e(){b=!1,f.$broadcast("CloseErrorModal")}var f=c.get("$rootScope"),g=c.get("ErrorModal");return b?a.reject(d):(b=!0,g.open(d,e),a.reject(d))}}}])}]),angular.module("app").run(["$rootScope","$state","CurrentUser",function(a,b,c){function d(){return Boolean(c.data&&c.data._id)}a.$on("$stateChangeStart",function(a,c,e,f,g){c.data&&c.data.guestOnly&&d()?(a.preventDefault(),b.go("dashboard")):c.data&&c.data.memberOnly&&!d()&&(a.preventDefault(),b.go("home"))})}]),angular.module("app").run(["$location","ErrorModal",function(a,b){var c=a.search();c.header&&c.message&&(b.open({header:c.header,message:c.message}),a.search({})),"_=_"===a.hash()&&a.url(a.path())}]),angular.module("app").service("CurrentUser",["$window",function(a){return{data:a.user||{}}}]),angular.module("app").service("ErrorModal",["$uibModal",function(a){var b=function(b,c){if(!angular.isObject(b))return void c();if(b=b.data?b.data:b,!(b.header&&b.header.length&&b.message&&b.message.length))return void c();var d=a.open({templateUrl:"modules/parts/error-modal/view.html",controller:["$scope","$uibModalInstance","info","$http",function(a,b,c,d){a.rejection=c.rejection,a.retry=function(){d(c.rejection.data.retry),b.close()},a.cancel=function(){b.dismiss("cancel")},a.$on("$stateChangeStart",a.cancel)}],resolve:{info:function(){return{rejection:b}}}});angular.isFunction(c)&&d.result.then(c,c)};return{open:b}}]),angular.module("app").filter("capitalize",[function(){return function(a){if(!a)return"";if("string"!=typeof a)return a;var b;switch(a){case"lepCount":case"iepCount":case"frlCount":b=a.slice(0,a.indexOf("Count")).toUpperCase();break;case"studentCount":b="Students";break;case"fetchCount":b="Fetched";break;default:b="";for(var c=!0,d=0,e=a.length;e>d;d++)b+=c?a[d].toUpperCase():a[d],c=" "===a[d];return b}return b}}]),angular.module("app").filter("percentage",[function(){return function(a){return a?(a=Number(a),Math.round(100*a)+"%"):""}}]),angular.module("app").filter("roughNumber",[function(){return function(a){var b=a;return b>=1e3&&1e4>b?(b=Math.round(b/100)/10,b+="k"):b>=1e4&&1e6>b?(b=Math.round(b/1e3),b+="k"):b>=1e6&&1e7>b?(b=Math.round(b/1e5)/10,b+="M"):b>=1e7&&(b=Math.round(b/1e6),b+="M"),b}}]),angular.module("app").controller("NavbarController",["$scope","CurrentUser",function(a,b){a.user=b.data,a.toggleNavbar=function(){angular.element(document.getElementById("navbar-collapse")).toggleClass("in")},a.tables=[{state:"districts",name:"Districts"},{state:"socialseeds",name:"Social Seeds"},{state:"socialmedia",name:"Social Media"},{state:"websites",name:"Web Sites"},{state:"webpages",name:"Web Pages"}],a.logout=function(a){a&&a.preventDefault(),window.location.assign("/data/user/sign-out")}}]),angular.module("app").directive("navbar",[function(){return{restrict:"A",templateUrl:"modules/parts/navbar/view.html",scope:{},controller:"NavbarController"}}]),angular.module("app").controller("DashboardController",["$scope","CurrentUser",function(a,b){a.user=b.data,a.connectTwitter=function(){window.location.assign("/data/user/twitter/connect")},a.connectFacebook=function(){window.location.assign("/data/user/facebook/connect")}}]),angular.module("app").controller("DistrictsController",["$scope","$resource","$uibModal","$window","$http",function(a,b,c,d,e){function f(){a.filterByStates=b("data/state/list").query({},function(){k.processingStates=!1},function(a){k.processingStates=!1,k.errorMessages.push("Error! We had trouble listing the states. Please try refreshing the page.")})}function g(){p.state&&(k.processingCounties=!0,a.filterByCounties=b("data/county/list").query({state:p.state},function(a){k.processingCounties=!1},function(a){k.processingCounties=!1,k.errorMessages.push("Error! We had trouble listing the counties. Please try selecting a different state.")}))}function h(){k.processingSummary=!0,l=b("data/district/summary").get(p,function(){k.processingSummary=!1},function(a){k.processingSummary=!1,k.errorMessages.push("Error! We had trouble getting the state/county summary. Please try selecting a different state/county combination.")})}function i(){if(!(m.length<n+o)){var a=1.5*d.innerHeight,c=document.getElementsByClassName("last-row");if(c=c.length?c[0].getBoundingClientRect().top:!1,c&&a>c){k.processingDistricts=!0,n+=o;var e={skip:n,limit:o};p.state&&(e.state=p.state),p.county&&(e.county=p.county),b("data/district/list").query(e,function(a){a.length<o&&angular.element(d).unbind("scroll"),angular.forEach(a,function(a){m.push(a)}),k.processingDistricts=!1},function(a){k.processingDistricts=!1,k.errorMessages.push("Error! We had trouble loading more districts for state="+p.state+" / county="+p.county+". Please try again.")})}}}function j(){k.processingDistricts=!0,angular.element(d).unbind("scroll"),n=0,m=a.districts=b("data/district/list").query({state:p.state,county:p.county,skip:n,limit:o},function(){k.processingDistricts=!1,angular.element(d).bind("scroll",i)},function(a){k.processingDistricts=!1,k.errorMessages.push("Error! We had trouble listing the districts for state="+p.state+" / county="+p.county+". Please try selecting a different state/county combination.")})}var k=a.status={processingStates:!0,processingCounties:!0,processingSummary:!0,processingDistricts:!0,errorMessages:[]},l=a.summary={},m=a.districts=[],n=0,o=20,p=a.filterBy={state:null,county:null};a.fields=["name","website","facebook","twitter","city","state","county","studentCount","lepCount","iepCount","frlCount"],a.dates=["modified","created"],f(),h(),j(),a.$watch("filterBy.state",function(a,b){a!==b&&(p.state=a,p.county=null,g(),h(),j())}),a.$watch("filterBy.county",function(a,b){a!==b&&(p.county=a,h(),j())}),a.create=function(){var a=c.open({templateUrl:"modules/main/districts/create/view.html",controller:"DistrictsCreateController"});a.result.then(function(a){m.push(a)},function(){console.log("dismiss")})},a.edit=function(a){var b=c.open({templateUrl:"modules/main/districts/edit/view.html",controller:"DistrictsEditController",resolve:{info:function(){return{district:angular.copy(a)}}}});b.result.then(function(b){b.update?a=angular.extend(a,b.update):b["delete"]&&m.splice(m.indexOf(a),1)},function(){console.log("dismiss")})},a.download=function(){d.location.href="http://"+d.location.host+"/data/district/download"},a.closeErrorMessage=function(a){a&&k.errorMessages[a]&&k.errorMessages.splice(a,1)}}]),angular.module("app").controller("DistrictsCreateController",["$scope","$uibModalInstance","$http","$resource",function(a,b,c,d){var e=a.status={},f=a.district={};a.cancel=function(){b.dismiss("cancel")};a.save=function(){e.processing=!0,c.post("data/district",f).success(function(a){e.processing=!1,b.close(a)}).error(function(a){e.errorMessage="Error! Please try again.\n"+a})}}]),angular.module("app").controller("DistrictsEditController",["$scope","$uibModalInstance","info","$http","$resource",function(a,b,c,d,e){a=angular.extend(a,c);var f=a.status={processing:!1,errorMessage:null},g=a.display={},h=a.params={};a.fields=["_id","name","cdsId","ncesId","website","facebook","twitter","street","city","state","zip","county","latitude","longitude","studentCount","lepCount","iepCount","frlCount","fetchCount","modified","created"],a.dates=["modified","created"],f.processing=!0;var i=a.fullDistrict=e("data/district").get({_id:c.district._id},function(){f.processing=!1},function(a){f.processing=!1,f.errorMessage="Error! We had trouble getting the district. Please try again"});a.cancel=function(){b.dismiss("cancel")},a.editFacebook=function(){if(i.facebookSeed)h.facebookQuery=i.facebookSeed.facebook.name;else if(i.facebookAccount){for(var a=i.facebookAccount,b=/\-/,c=/[^A-Z\s]{1}[A-Z]{1}[a-z]+/,d=/\?[^\s]*$/;a.search(b)>-1;)a=a.replace(b," ");for(;a.search(c)>-1;)a=a.slice(0,a.search(c)+1)+" "+a.slice(a.search(c)+1);for(;a.search(d)>-1;)a=a.replace(d,"");h.facebookQuery=a}g.editFacebook=!0};a.cancelEditFacebook=function(){f.processing=!1,f.errorMessage=null,h.facebookQuery=null,h.facebookItem=null,g.editFacebook=!1,g.facebookResults=!1,g.facebookItem=!1};a.searchFacebook=function(){f.processing=!0,f.errorMessage=null,g.facebookResults=!0,a.facebookResults=e("data/socialseed/facebook/search").get({query:h.facebookQuery},function(){f.processing=!1},function(a){f.processing=!1,f.errorMessage="Error! Please try again.\n"+a})},a.selectFacebook=function(a,b){f.processing=!0;var c={platform:"facebook",facebook:{id:a.id,name:a.name,type:b?b.slice(0,-1):null,category:a.category?a.category:"Group"},frequency:"daily"};d.post("data/socialseed",c).success(function(a){i.facebookSeed=a._id,j()}).error(function(a){f.processing=!1,f.errorMessage="Error! Please try again.\n"+a})};var j=a.save=function(){f.errorMessage&&delete f.errorMessage,f.processing=!0,d.put("data/district",i).success(function(){b.close({update:i})}).error(function(a){f.processing=!1,f.errorMessage="Error! We had trouble updating the district. Please try again"})};a["delete"]=function(e){return f.errorMessage&&delete f.errorMessage,e?(f.processing=!0,void d["delete"]("data/district",{data:{_id:c.district._id}}).success(function(){b.close({"delete":!0})}).error(function(b){f.processing=!1,a.confirmDelete=!1,f.errorMessage="Error! We had trouble deleting the district. Please try again"})):void(a.confirmDelete=!a.confirmDelete)},a.getQuery=function(a){return encodeURIComponent(a)}}]),angular.module("app").controller("HomeController",["$scope",function(a){a.message="Something cool."}]),angular.module("app").controller("SocialMediaController",["$scope","$resource","$uibModal","$window",function(a,b,c,d){function e(){if(!(a.media.length<h+i)){var c=1.5*d.innerHeight,e=document.getElementsByClassName("last-row");e=e.length?e[0].getBoundingClientRect().top:!1,e&&c>e&&(console.log("load more media"),g.processing=!0,h+=i,b("data/socialmedia/list").query({filterBy:j.type,skip:h,limit:i},function(b){g.processing=!1,g.errorMessage=null,b.length<i&&angular.element(d).unbind("scroll"),angular.forEach(b,function(b){a.media.push(b)})},function(a){g.processing=!1,g.errorMessage="Error! We had trouble loading more social media docs.\n"+a}))}}function f(){console.log("reload media w/ filterBy="+j.type),g.processing=!0,angular.element(d).unbind("scroll"),h=0,a.media=b("data/socialmedia/list").query({filterBy:j.type,skip:h,limit:i},function(){g.processing=!1,angular.element(d).bind("scroll",e)},function(a){g.processing=!1,g.errorMessage="Error! Could not load social media. Please try refreshing the page.\n"+a})}var g=a.status={processing:!0,processingSummary:!0},h=(a.fields=["no","date","text","seed","platform","ngrams","sentiment","probability"],a.dates=["date","ngramsProcessed","sentimentProcessed","modified","created"],0),i=20,j=a.filterBy={type:"all"};a.filterByOptions=["ngrams","sentiment","facebook","instagram","twitter","all"];a.media=b("data/socialmedia/list").query({filterBy:j.type,skip:h,limit:i},function(a){g.processing=!1},function(a){g.processing=!1,g.errorMessage="Error! Could not load social media. Please try refreshing the page.\n"+a}),a.summary=b("data/socialmedia/summary").get({},function(a){g.processingSummary=!1},function(a){g.processingSummary=!1,g.errorMessage||(g.errorMessage="Error! Could not get social media summary. Please try refreshing the page.\n"+a)}),angular.element(d).bind("scroll",e),a.$watch("filterBy.type",function(a,b){a!==b&&f()}),a.download=function(){var a=c.open({templateUrl:"modules/main/social-media/download/view.html",controller:"SocialMediaDownloadController"});a.result.then(function(){console.log("close")},function(){console.log("dismiss")})},a.read=function(a){var b=c.open({templateUrl:"modules/main/social-media/read/view.html",controller:"SocialMediaReadController",resolve:{info:function(){return{mediaDocId:a._id}}}});b.result.then(function(){console.log("close")},function(){console.log("dismiss")})}}]),angular.module("app").controller("SocialMediaDownloadController",["$scope","$uibModalInstance","$resource","$window",function(a,b,c,d){function e(){l=a.states=c("data/state/list").query({},function(){g.processing=!1},function(a){g.processing=!1,g.errorMessages.push("Error! We had trouble listing the states. Please try switching tabs.")})}function f(b){switch(k=b,j=a.activeTab=i[k],j.name){case"districts.by.state":l&&l.length||(g.processing=!0,g.errorMessage=null,e());break;case"skip.limit":g.processing=!1,g.errorMessage=null}}var g=a.status={processing:!1,errorMessage:null},h=a.params={skip:0,limit:5e3,minDate:function(){var a=new Date;return a.setMonth(a.getMonth()-1),a}(),maxDate:new Date},i=a.tabs=[{name:"districts.by.state",display:"Districts by State"},{name:"skip.limit",display:"Skip/Limit"}],j=a.activeTab=null,k=a.activeTabIndex=null,l=a.states=null;f(0),a.$watch("activeTabIndex",function(a,b){a!==b&&f(a)}),a.download=function(){var a="http://"+d.location.host+"/data/socialmedia/download",b=[];switch(j.name){case"districts.by.state":a+="?type=districts-by-state",b=["state","minDate","maxDate"];break;case"skip.limit":a+="?type=skip-limit",b=["minDate","maxDate","skip","limit"];break;default:return void console.log("download type not supported")}b.forEach(function(b){h[b]&&(a+="&"+b+"="+h[b])}),console.log(a),d.location.href=a},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("app").controller("SocialMediaReadController",["$scope","$uibModalInstance","info","$http","$resource",function(a,b,c,d,e){a=angular.extend(a,c);var f=a.mediaDoc=e("data/socialmedia").get({_id:c.mediaDocId});a.fields=["_id","date","text","seed","platform","data","status","processed","meta"],a.dates=["date","processed","modified","created"],a.showData=!1,a.showMeta=!1,a.cancel=function(){b.dismiss("cancel")},a.getMediaText=function(){return f&&f.text?f.text.length>200?f.text.slice(0,200)+"...":f.text:"*** no text ***"},a.toggleData=function(){a.showData=!a.showData,a.showData&&(a.showMeta=!1)},a.toggleMeta=function(){a.showMeta=!a.showMeta,a.showMeta&&(a.showData=!1)},a.getDataAsJSON=function(){return JSON.stringify(f.data,null,4)},a.getMetaAsJSON=function(){return JSON.stringify(f.meta,null,4)}}]),angular.module("app").controller("SocialSeedsController",["$scope","$resource","$uibModal","$window","$http",function(a,b,c,d,e){function f(){if(!(l.length<i+j)){var a=1.2*d.innerHeight,c=document.getElementsByClassName("last-row");c=c.length?c[0].getBoundingClientRect().top:!1,c&&a>c&&(h.processing=!0,i+=j,b("data/socialseed/list").query({status:k.status,platform:k.platform,type:k.type,skip:i,limit:j},function(a){a.length<j&&angular.element(d).unbind("scroll"),angular.forEach(a,function(a,b){l.push(a)}),h.processing=!1}))}}function g(){console.log("reload seeds"),console.log(k),h.processing=!0,angular.element(d).unbind("scroll"),i=0,l=a.seeds=b("data/socialseed/list").query({status:k.status,platform:k.platform,type:k.type,skip:i,limit:j},function(){h.processing=!1,angular.element(d).bind("scroll",f)})}var h=a.status={processing:!0},i=0,j=20,k=a.filterBy={status:"active",platform:null,type:null},l=a.seeds=b("data/socialseed/list").query({status:k.status,skip:i,limit:j},function(){h.processing=!1}),m=a.fields=["title","platform","type","frequency","references","media","initialized"],n=a.dates=["initialized","created"];a.filterByStatuses=["active","pending","never","all"],a.filterByPlatforms=["facebook","instagram","twitter","all"],a.filterByTypes={facebook:["group","page","all"],instagram:["hashtag","username","all"],twitter:["query","hashtag","screen_name","geocode","all"]},a.summary=b("data/socialseed/summary").get(),angular.element(d).bind("scroll",f),a.$watch("filterBy.status",function(a,b){a!==b&&(k.status=a,g())}),a.$watch("filterBy.platform",function(a,b){a!==b&&(k.platform="all"===a?null:a,g())}),a.$watch("filterBy.type",function(a,b){a!==b&&(k.type="all"===a?null:a,g())}),a.$watch("filterBy",function(c,e){(c.status!==e.status||c.platform!==e.platform||c.type!==e.type)&&(console.log(c),"all"===c.platform&&(c.platform=null),"all"===c.type&&(c.type=null),h.processing=!0,angular.element(d).unbind("scroll"),k=c,i=0,l=a.seeds=b("data/socialseed/list").query({status:k.status,platform:k.platform,type:k.type,skip:i,limit:j},function(){angular.element(d).bind("scroll",f)}))}),a.create=function(){var a=c.open({templateUrl:"modules/main/social-seeds/create/view.html",controller:"SocialSeedsCreateController"});a.result.then(function(a){l.push(a)},function(){console.log("dismiss")})},a.edit=function(a){var b=c.open({templateUrl:"modules/main/social-seeds/edit/view.html",controller:"SocialSeedsEditController",resolve:{info:function(){return{seed:angular.copy(a),fields:m,dates:n}}}});b.result.then(function(b){b.update?a=angular.extend(a,b.update):b["delete"]&&l.splice(l.indexOf(a),1)},function(){console.log("dismiss")})},a.showPullBtns="localhost"===d.location.hostname,a.pullTwitter=function(){e.get("/data/socialmedia/pull/twitter").success(function(a){}).error(function(a){})},a.pullFacebook=function(){e.get("/data/socialmedia/pull/facebook").success(function(a){}).error(function(a){})}}]),angular.module("app").controller("SocialSeedsCreateController",["$scope","$uibModalInstance","$http","$resource",function(a,b,c,d){var e=a.status={step:1},f=a.platforms=["facebook","instagram","twitter"],g=a.seed={platform:"facebook",frequency:"daily"},h=a.facebookResultTypes=["pages","groups"];a.cancel=function(){b.dismiss("cancel")};var i=a.save=function(a){e.processing=!0,c.post("data/socialseed",g).success(function(c){return e.processing=!1,e.errorMessage=null,a?a():void b.close(c)}).error(function(a){e.processing=!1,e.errorMessage="Error! Please try again.\n"+a})};a.activePlatform=f.indexOf(g.platform),a.$watch("activePlatform",function(a,b){if(a!==b)switch(g.platform=f[a],g.platform){case"facebook":g.facebook={},g.twitter&&delete g.twitter;break;case"twitter":g.twitter={},g.facebook&&delete g.facebook}});var j=a.activeFacebookResultType=h.indexOf("groups");a.getActiveFacebookResultType=function(){return console.log("get",j),j},a.setActiveFacebookResultType=function(a){console.log("set",a),j=h.indexOf(a)},a.searchFacebook=function(){e.processing=!0,e.errorMessage=null,a.facebookResults=d("data/socialseed/facebook/search").get({query:g.facebook.query},function(){e.processing=!1},function(a){e.processing=!1,e.errorMessage="Error! Please try again.\n"+a})},a.selectFacebook=function(b){a.facebookFields=["id","name","category"],e.step=2,g.facebook.id=b.id,g.facebook.name=b.name,g.facebook.type=j.slice(0,-1),g.facebook.category=b.category?b.category:"Group"};var k=a.step1Facebook=function(){e.step=1,delete g.facebook.id,delete g.facebook.name,delete g.facebook.category};a.saveAndStep1Facebook=function(){i(function(){k()})}}]),angular.module("app").controller("SocialSeedsEditController",["$scope","$uibModalInstance","info","$http","$resource",function(a,b,c,d,e){a=angular.extend(a,c),a.showHistory=!1,a.fullSeed=null,a.cancel=function(){b.dismiss("cancel")},a.save=function(){d.put("data/socialseed",{_id:c.seed._id,frequency:c.seed.frequency}).success(function(){b.close({update:c.seed})}).error(function(a){})},a["delete"]=function(e){return e?(d["delete"]("data/socialseed",{data:{_id:c.seed._id}}).success(function(){b.close({"delete":!0})}).error(function(a){}),void b.close({"delete":!0})):void(a.confirmDelete=!a.confirmDelete)},a.toggleHistory=function(){a.showHistory=!a.showHistory,a.fullSeed||(a.fullSeed=e("data/socialseed").get({_id:c.seed._id}))},a.getQuery=function(a){return encodeURIComponent(a)}}]),angular.module("app").controller("UserController",["$scope","$http","$resource","$state","CurrentUser",function(a,b,c,d,e){function f(a){a&&a.message&&(j.message=a.message),j.processing=!1}function g(a){j.successMessage=a,setTimeout(function(){j.successMessage=null},1e3)}function h(a){a&&a._id?(e.data=angular.extend(e.data,a),d.go("dashboard")):f({message:"We had trouble logging you in. Please try again."})}var i=a.user={},j=a.status={};a.signUp=function(){return i.email&&i.password?(j.processing=!0,void b.post("/data/user/sign-up",i).success(h).error(f)):void(j.message="*Email and password are required!")},a.login=function(){return i.email&&i.password?(j.processing=!0,void b.post("/data/user/sign-in",i).success(h).error(f)):void(j.message="*Email and password are required!")};var k;d.is("user.settings")&&(i=a.user=c("data/user/settings").get(function(){k=angular.copy(i)},f));var l=a.showEdit=function(b,c){a["edit"+b]=c?!1:!0};a.update=function(a){function c(){l(a,!0),"Email"===a?(k.email=i.email,e.data.username=i.email.slice(0,i.email.indexOf("@")),g("Email address updated!")):"Password"===a&&g("Password changed!"),j.processing=!1}var d={};switch(a){case"Email":if(!i.email||i.email===k.email)return i.email=k.email,void l("Email",!0);d.email=i.email;break;case"Password":if(!i.password&&!i.newPassword)return void l("Password",!0);if(!i.password)return void(j.message="Please provide your current password.");if(!i.newPassword)return void(j.message="Please provide a new password.");d.password=i.password,d.newPassword=i.newPassword}j.processing=!0,b.put("/data/user/settings",d).success(c).error(f)},a.toggleTwitter=function(){j.processing=!0,i.twitter?b.get("/data/user/twitter/disconnect").success(function(){i.twitter=!1,j.processing=!1,g("Twitter Disconnected!")}).error(f):window.location.assign("/data/user/twitter/connect")},a.toggleFacebook=function(){j.processing=!0,i.facebook?b.get("/data/user/facebook/disconnect").success(function(){i.facebook=!1,j.processing=!1,g("Facebook Disconnected!")}).error(f):window.location.assign("/data/user/facebook/connect")}}]),angular.module("app").controller("WebPagesController",["$scope","$resource","$uibModal","$http","$window",function(a,b,c,d,e){function f(){if(!(i.length<g+h)){var a=1.2*e.innerHeight,c=document.getElementsByClassName("last-row");c=c.length?c[0].getBoundingClientRect().top:!1,c&&a>c&&(g+=h,b("data/webpage/list").query({skip:g,limit:h},function(a){a.length<h&&angular.element(e).unbind("scroll"),angular.forEach(a,function(a,b){i.push(a)})}))}}a.showPullBtns="localhost"===e.location.hostname,a.summary=b("data/webpage/summary").get(),a.filterBy="pending";var g=0,h=20,i=a.pages=b("data/webpage/list").query({skip:g,limit:h,filterBy:a.filterBy});a.fields=["url","status","type","crawlDate","title","links","references","referencesSocialMedia","created"],a.dates=["crawlDate","created"];a.download=function(){e.location.href="http://"+e.location.host+"/data/webpage/download"},angular.element(e).bind("scroll",f),a.$watch("filterBy",function(c,d){c!==d&&(angular.element(e).unbind("scroll"),g=0,i=a.pages=b("data/webpage/list").query({skip:g,limit:h,filterBy:c},function(){angular.element(e).bind("scroll",f)}))})}]),angular.module("app").controller("WebSitesController",["$scope","$resource","$uibModal","$window",function(a,b,c,d){function e(){if(!(h.length<f+g)){var a=1.2*d.innerHeight,c=document.getElementsByClassName("last-row");c=c.length?c[0].getBoundingClientRect().top:!1,c&&a>c&&(f+=g,b("data/website/list").query({skip:f,limit:g},function(a){a.length<g&&angular.element(d).unbind("scroll"),angular.forEach(a,function(a,b){h.push(a)})}))}}a.summary=b("data/website/summary").get(),a.filterBy="crawl";var f=0,g=20,h=a.sites=b("data/website/list").query({skip:f,limit:g,filterBy:a.filterBy}),i=a.fields=["domain","url","crawl","category","notes","useRobots","disallow","fetched","ignored","redirected","scheduled","references","created"],j=a.dates=["created"];a.create=function(){var a=c.open({templateUrl:"modules/main/web-sites/create/view.html",controller:"WebSitesCreateController"});a.result.then(function(a){h.push(a)},function(){console.log("dismiss")})},a.edit=function(a){var b=c.open({templateUrl:"modules/main/web-sites/edit/view.html",controller:"WebSitesEditController",resolve:{info:function(){return{site:angular.copy(a),fields:i,dates:j}}}});b.result.then(function(b){b.update?a=angular.extend(a,b.update):b["delete"]&&h.splice(h.indexOf(a),1)},function(){console.log("dismiss")})},angular.element(d).bind("scroll",e),a.$watch("filterBy",function(c,i){c!==i&&(angular.element(d).unbind("scroll"),f=0,h=a.sites=b("data/website/list").query({skip:f,limit:g,filterBy:c},function(){angular.element(d).bind("scroll",e)}))})}]);